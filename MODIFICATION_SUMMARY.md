# 银行投资风险审核系统 - 个性化产品推荐功能升级

## 概述

本次升级为投资策略增加了多样性，将固定的产品组合改为基于用户得分动态个性化推荐的系统。通过引入更丰富的数据库结构和智能推荐算法，为不同风险偏好的用户提供更加精准和个性化的投资建议。

## 主要改进

### 1. 数据库结构扩展

#### 新增表结构

**products 表扩展**（扩展版）
- 新增字段：
  - `expected_volatility` - 预期波动率
  - `sharpe_ratio` - 夏普比率
  - `max_drawdown` - 最大回撤
  - `historical_return_1y` - 1年历史收益率
  - `historical_return_3y` - 3年历史收益率
  - `historical_return_5y` - 5年历史收益率
  - `expense_ratio` - 费率
  - `minimum_investment` - 最低投资额
  - `liquidity_score` - 流动性评分
  - `market_cap` - 市值规模
  - `sector` - 行业板块

**product_tags 表**（产品标签表）
- 字段：`id`, `tag_name`, `tag_category`, `description`, `created_at`
- 用途：为产品添加标签，支持多维度分类

**product_tag_relations 表**（产品标签关联表）
- 字段：`id`, `product_id`, `tag_id`, `created_at`
- 用途：建立产品与标签的多对多关系

**product_ratings 表**（产品评分表）
- 字段：`product_id`, `rating_date`, `overall_rating`, `risk_adjusted_rating`, `performance_rating`, `liquidity_rating`, `rating_agency`
- 用途：存储产品评级信息

#### 初始数据

添加了15个示例产品，涵盖：
- 现金类产品（3个）
- 债券类产品（3个）
- ETF产品（3个）
- 股票型基金（6个）
- 另类投资（REITs、商品期货）

每个产品都有完整的属性信息和标签关联。

### 2. 后端功能升级

#### 新增实体类
- `ProductTag` - 产品标签实体
- `ProductTagRelation` - 产品标签关联实体
- `ProductRating` - 产品评分实体

#### 新增Repository接口
- `ProductTagRepository` - 标签数据访问
- `ProductTagRelationRepository` - 标签关联数据访问
- `ProductRatingRepository` - 评分数据访问

#### 核心算法升级

**ProductRecommendationService**（新服务）
- 智能推荐策略确定
- 多因子产品评分算法
- 个性化投资组合生成
- 风险调整和优化

**PortfolioGenerationService 重构**
- 集成新的推荐算法
- 支持动态产品选择
- 基于用户风险偏好的智能分配

#### 新增API接口

**ProductController**
- `POST /products/recommend` - 获取个性化产品推荐
- `GET /products` - 获取产品列表（支持筛选）
- `GET /products/{id}` - 获取产品详情
- `GET /products/tags` - 获取产品标签
- `GET /products/by-tag/{tagId}` - 根据标签获取产品

### 3. 前端功能升级

#### InvestmentAdvice.vue 完全重构

**新功能特性**
- 动态加载个性化推荐
- 实时显示推荐状态（加载中、成功、错误）
- 详细的投资组合展示
- 产品分配可视化
- 推荐产品列表展示
- 多种操作按钮（接受、重新生成、导出）

**UI/UX 改进**
- 渐变背景的推荐头部
- 响应式网格布局
- 产品卡片悬停效果
- 进度条显示分配比例
- 彩色标签区分产品类型和风险等级

**交互功能**
- 自动加载用户推荐
- 手动重新生成建议
- 投资组合详情展开
- 产品评分和指标展示

### 4. 推荐算法详解

#### 策略确定算法
根据用户风险评分确定推荐策略：
- **保守型（<35分）**：70%保守 + 25%平衡 + 5%激进
- **稳健型（35-65分）**：30%保守 + 50%平衡 + 20%激进
- **激进型（>65分）**：10%保守 + 30%平衡 + 60%激进

#### 产品评分算法
综合评分公式：
```
产品评分 = 收益评分 × 25% + 风险评分 × 30% + 夏普比率评分 × 25% + 评级评分 × 20%
```

#### 组合优化算法
1. 按风险等级筛选候选产品
2. 根据评分排序选择最佳产品
3. 按策略比例分配资金
4. 计算组合预期收益和风险

### 5. 系统优势

#### 多样性提升
- 从固定3个组合扩展到数万个可能的组合
- 支持15种不同类型的产品
- 基于用户偏好的个性化推荐

#### 智能化增强
- 多因子评分系统
- 风险调整算法
- 动态组合优化

#### 用户体验改善
- 实时个性化推荐
- 直观的视觉展示
- 丰富的交互功能

## 技术实现亮点

### 1. 数据库设计
- 规范化表结构
- 丰富的索引优化
- 完整的数据约束

### 2. 算法创新
- 基于多因子的评分算法
- 动态权重调整
- 风险偏好匹配

### 3. 前端架构
- Vue 3 Composition API
- 响应式数据管理
- 组件化设计

### 4. API设计
- RESTful接口规范
- 统一的响应格式
- 完善的错误处理

## 使用说明

### 数据库初始化
```sql
-- 执行更新后的mysql.sql文件
source mysql.sql;
```

### 后端启动
```bash
cd backend
mvn spring-boot:run
```

### 前端集成
系统会自动调用新的推荐API，动态展示个性化投资建议。

## 扩展性

### 未来优化方向
1. **机器学习集成**：引入ML算法优化推荐准确性
2. **实时数据接入**：接入市场数据提供更精准的建议
3. **用户行为分析**：基于用户历史行为优化推荐
4. **A/B测试框架**：支持不同算法的对比测试

### 产品类型扩展
系统设计支持轻松添加新的产品类型和标签，只需：
1. 在数据库中添加新产品
2. 更新推荐算法权重
3. 前端自动适配显示

## 总结

本次升级成功将固定产品组合系统转换为智能化、个性化的推荐平台。通过引入丰富的数据库结构、先进的推荐算法和优秀的用户界面，为用户提供了更加精准和多样化的投资建议，显著提升了系统的实用性和竞争力。

---

**升级完成时间**：2024年12月
**涉及文件数量**：20+ 个文件
**新增功能模块**：4个核心服务 + 1个控制器 + 1个前端页面
**数据库表数量**：从5个扩展到8个
**API接口数量**：从原有基础上新增5个
